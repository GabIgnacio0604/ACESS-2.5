<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Council Candidates</title>
  <link rel="stylesheet" href="../CSS/ACESS_EditCandidates.css" />
  <link rel="stylesheet" href="../CSS/ACESS_Universal_Sidebar.css" />
  <script src="../JS/config.js"></script>
</head>

<body>
  <div class="dashboard-container">

    <!-- Sidebar -->
    <aside class="sidebar">
      <a href="ACESS_Admin_Dashboard.html">
        <img src="../Images/School_Logo.jpg" alt="Logo" class="logo">
      </a>
      <p class="account-name" id="account-name">Loading...</p>
      <button class="logout-btn" id="logoutButton">Logout</button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Topbar -->
      <div class="topbar">
        <button class="menu-toggle" id="menu-toggle">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <h2 class="announcements-title">Student Council Candidates</h2>
        <div class="topbar-icons">
        </div>
      </div>

      <!-- Candidates Section -->
      <div class="candidate-section">
        <div class="section-header">
          <h3>Available Candidates</h3>
          <button type="button" class="create-btn" id="addCandidateBtn">+ Add Candidate</button>
        </div>

        <div class="candidate-container" id="candidateList">
          <div class="candidate-card">
            <div class="candidate-info">
              <strong>John Doe</strong> - President
            </div>
            <div>
              <button class="edit-btn">Edit</button>
            </div>
          </div>

          <div class="candidate-card">
            <div class="candidate-info">
              <strong>Jane Smith</strong> - Vice President
            </div>
            <div>
              <button class="edit-btn">Edit</button>
            </div>
          </div>

          <div class="candidate-card">
            <div class="candidate-info">
              <strong>Jane Smith</strong> - Secretary
            </div>
            <div>
              <button class="edit-btn">Edit</button>
            </div>
          </div>

          <div class="candidate-card">
            <div class="candidate-info">
              <strong>Jane Smith</strong> - Grade 12
            </div>
            <div>
              <button class="edit-btn">Edit</button>
            </div>
          </div>
        </div>
      </div>
  </div>
  </div>

  <!-- Add/Edit Candidate Modal -->
  <div class="modal" id="candidateModal">
    <div class="modal-content">
      <h3 id="modalTitle">Add New Candidate</h3>
      <form id="candidateForm">
        <div class="form-group">
          <label for="candidateName">Candidate Name:</label>
          <input type="text" id="candidateName" name="candidateName" required placeholder="Enter candidate name">
        </div>
        <div class="form-group">
          <label for="position">Position:</label>
          <select id="position" name="position" required>
            <option value="">Select a position</option>
            <option value="President">President</option>
            <option value="Vice President">Vice President</option>
            <option value="Secretary">Secretary</option>
            <option value="Treasurer">Treasurer</option>
            <option value="Auditor">Auditor</option>
            <option value="P.I.O">P.I.O</option>
            <option value="P.O">P.O</option>
            <option value="Grade 12">Grade 12 Representative</option>
            <option value="Grade 11">Grade 11 Representative</option>
            <option value="Grade 10">Grade 10 Representative</option>
            <option value="Grade 9">Grade 9 Representative</option>
            <option value="Grade 8">Grade 8 Representative</option>
            <option value="Grade 7">Grade 7 Representative</option>
          </select>
        </div>
        <div class="modal-buttons">
          <button type="submit" class="save-btn">Save</button>
          <button type="button" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
<script src="../JS/session_manager.js"></script>
  <script src="../JS/sidebar.js"></script>
  <script src="../JS/main.js"></script>
  <script src="JS/candidates.js">
    document.addEventListener("DOMContentLoaded", async () => {
      // Get DOM elements
      const nameElement = document.querySelector(".account-name");
      const modal = document.getElementById("candidateModal");
      const addButton = document.getElementById("addCandidateBtn");
      const cancelButton = modal.querySelector(".cancel-btn");
      const editButtons = document.querySelectorAll(".edit-btn");
      const candidateForm = document.getElementById("candidateForm");
      const modalTitle = document.getElementById("modalTitle");

      console.log("Modal element:", modal);
      console.log("Add button element:", addButton);

      console.log("Add button found:", addButton); // Debug line

      // Fetch user name
      try {
        const res = await fetch("Php/get_logged_user.php");
        const data = await res.json();

        if (data.fullname) {
          nameElement.textContent = data.fullname;
        } else {
          nameElement.textContent = "Not Logged In";
          console.error("Error fetching name:", data.error);
        }
      } catch (err) {
        console.error("Fetch failed:", err);
        nameElement.textContent = "Error";
      }

      // Open modal for adding new candidate
      if (addButton) {
        console.log("Add button found and setting up click handler");
        addButton.addEventListener("click", function (e) {
          e.preventDefault();
          console.log("Add button clicked");
          console.log("Modal before:", modal.style.display);
          modalTitle.textContent = "Add New Candidate";
          candidateForm.reset();
          modal.style.display = "flex";
          modal.classList.add("active");
          console.log("Modal after:", modal.style.display, modal.className);
        });
      } else {
        console.error("Add button not found in the document");
      }

      // Open modal for editing candidate
      editButtons.forEach(button => {
        button.onclick = (e) => {
          e.preventDefault();
          console.log("Edit button clicked"); // Debug line
          modalTitle.textContent = "Edit Candidate";
          const candidateCard = button.closest(".candidate-card");
          const candidateInfo = candidateCard.querySelector(".candidate-info").textContent;

          // Parse candidate info
          const [name, position] = candidateInfo.split(" - ");
          document.getElementById("candidateName").value = name.trim();
          document.getElementById("position").value = position.trim();

          modal.style.display = "flex";
          modal.classList.add("active");
        };
      });

      // Close modal
      if (cancelButton) {
        cancelButton.onclick = (e) => {
          e.preventDefault();
          modal.style.display = "none";
          modal.classList.remove("active");
        };
      }

      // Close modal when clicking outside
      window.onclick = (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
          modal.classList.remove("active");
        }
      };

      // Handle form submission
      if (candidateForm) {
        candidateForm.onsubmit = async (e) => {
          e.preventDefault();
          const formData = new FormData(candidateForm);
          const candidateData = {
            name: formData.get("candidateName"),
            position: formData.get("position")
          };

          console.log("Submitting candidate:", candidateData);
          // TODO: Add API call to save candidate data

          modal.style.display = "none";
          modal.classList.remove("active");
        };
      }
    });
  </script>
</body>

</html>